+++
title = "elispのバッククォートを使う"
author = ["karuta"]
publishDate = 2021-12-26T00:00:00+09:00
tags = ["elisp"]
draft = true
+++

バッククォートはマクロ定義のときにだけ使うものかなと誤解していたので、使い方を整理しておこうと思う。  

<!--more-->  

まずは簡単に次のような評価を経て1から3を要素に持つリストが得られること確認する。  

```elisp
(cons 1 (list (+ 1 1) (+ 1 2)))
```

```text
(1 2 3)
```

そして次にマクロ定義以外でも `バッククォート` を使いその中で `,@` 部分が評価されることが確認できる。  

```elisp
(` (1 (,@ (list (+ 1 1) (+ 1 2)))))
```

```text
(1 2 3)
```

もうすこし `,@` が何をしてるのかみてみよう。次は文法エラーで評価されない。  

```elisp
(` (1 (,@ (+ 1 1)) 3))
```

一方 `,` を使えば意図どおりの結果が得られる。  

```elisp
(` (1 ,(+ 1 1) 3))
```

```text
(1 2 3)
```

バッククォートがあっても `,@` や `,`  がなければシンボルとして認識される  

```elisp
(` (1 (+ 1 1) 3))
```

```text
(1 (+ 1 1) 3)
```

以上からわかることは、バッククォート内で `,` , `,@` が特殊な記号を持ってることがわかる。前者が変数を評価するだけに対して、後者は評価結果のリストを自身を包んでいるリストにマージしてくれる機能を持っているということ。  

後者についてもう少し説明しよう。  

まず `,` だけつかってみると次のように `(list 2)` の評価結果がそのままリストにマージされている。  

```elisp
(let ((test 2))
  (` (1 ,(list 2) 3)))
```

```text
(1 (2) 3)
```

このマージ方法をもっとうまくやりたいときに使うのが `,@` であり、評価されたリスト要素を親のリストの要素として扱ってくれる。  

```elisp
(let ((test 2))
  (` (1 ,@(list 2) 3)))
```

```text
(1 2 3)
```

以上lispのバッククォートについて理解できたと思う。
