+++
title = "awkコマンドの使い方基本"
author = ["karuta"]
publishDate = 2021-10-23T00:00:00+09:00
tags = ["shell", "awk"]
draft = true
+++

awkコマンドの書き方の基本を整理しておこう  

<!--more-->  

一番簡単な表記はつぎのようになる。パターンは該当する行を絞り込みする部分であり、アクションはマッチした行に対して実行される処理のことである。  

```shell
awk 'パターン {アクション}'
```

たとえば、1から10の行データに対して、その偶数番目を出力するには次のようにかける。  

```shell
seq 10 | awk '$1 % 2 == 0 {print $0}'
```

2  
4  
6  
8  
10  

`$1 % 2 == 0` の部分がパターンである。これで偶数だけ絞ってる。そして `{print $0}` によって絞り込んだ行だけ表示している。  

ただそのまま表示するだけならば次のようにアクション部分を省略しても問題ない。  

```shell
seq 10 | awk '$1 % 2 == 0'
```

2  
4  
6  
8  
10  

パターンとアクションが複数ある場合は次のように書くことができる  

```shell
awk 'パターン1 {アクション1} パターン2 {アクション2}'
```

やってみよう。偶数の場合は1をかけてにして、奇数の場合は-1をかけてみる。  

```shell
seq 10 | awk '$1 % 2 == 0 { print $1 * 1 } $1 % 2 == 1 { print $1 * -1 }'
```

-1  
2  
-3  
4  
-5  
6  
-7  
8  
-9  
10  

このようにマッチするパターンを左からなめてアクションされていく。  

次に `BEGIN` `END` について説明先程の `パターン {アクション}` の左右にBEGINとENDという命令を書くことができる。  
BEGINはパターンアクションの前に行う操作を、ENDはパターンアクションが終わったあとの処理を書くことができる  

```shell
seq 10 | awk 'BEGIN { print "Begin"} $1 % 2 == 0 {print $0} END { print "End" }'
```

Begin  
2  
4  
6  
8  
10  
End  

たとえば、総和をもとめることができる。  

```shell
seq 10 | awk 'BEGIN { sum = 0 } $1 % 2 == 0 { sum += $1 } END { print sum }'
```
